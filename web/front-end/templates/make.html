{% extends "general.html" %}

{% block styles %}
<link rel="stylesheet" href="/media/css/chosen.css">
<style type="text/css" media="screen">
  .slides_container {
    height:300px;
  }
</style>
{% endblock styles %}

{% block scripts %}
  <script src="/media/js/chosen.jquery.js" type="text/javascript"></script>
  <script src="/media/js/slides.min.jquery.js" type="text/javascript"></script>
  <script src="/media/js/bootstrap-datepicker.js" type="text/javascript"></script>
  <script>
    $(function(){
      //$('#slides').slides({
        //generatePagination:false
      //});
    
      $(".chzn-select").chosen();
      /*$("#doc-select").chosen().change(function () {
          window.location.href = '/' + $(this).val()
      });*/
    
    
      console.log('shit be clicked');
    
  });
  </script>
  <script>
  $(function(){
    $.extend($.fn.datepicker.defaults, {
      parse: function (string) {
        var matches;
        if ((matches = string.match(/^(\d{2,2})\/(\d{2,2})\/(\d{4,4})$/))) {
          return new Date(matches[3], matches[1] - 1, matches[2]);
        } else {
          return null;
        }
      },
      format: function (date) {
        var
          month = (date.getMonth() + 1).toString(),
          dom = date.getDate().toString();
        if (month.length === 1) {
          month = "0" + month;
        }
        if (dom.length === 1) {
          dom = "0" + dom;
        }
        return month + "/" + dom + "/" + date.getFullYear();
      }
    });  
  });
</script>
{% endblock scripts %}

{% block content %}
  <div class="content">
    {% if new_doc %}
      <iframe src="https://docs.google.com/document/d/{{new_doc}}/edit" class="iframe" scrolling="no" allowTransparency="true">
        <p>Your browser does not support iframes.</p>
      </iframe>{% csrf_token %}
    {% else %}
    <center><h1>Create an Exam</h1></center>
    <hr>
    <div id="slides">
      <div class="slides_container" id="info-blah">
        <div class="row">
          <div class="span3">&nbsp;</div>
          <div class="span6">
            <form id="info-form" class="form-horizontal" action="." method="post">{% csrf_token %}
              <h2>1. Name Your Essay</h2>
              <input id="id_exam_name" type="text" name="exam_name" maxlength="80" placeholder="Humanities 101-406 First Midterm"/>
              <div class="clearfix">
                <label><h2>2. When will this exam take place?</h2></label>
                <div class="input">
                  <div class="inline-inputs">
                    <input data-datepicker="datepicker" class="small" name="start_date" type="text" value="01/05/2011" />
                    <input class="mini" name="start_time" type="text" value="12:00am" />
                    to
                    <input data-datepicker="datepicker" class="small" name="end_date" type="text" value="05/08/2011" />
                    <input class="mini" name="end_time" type="text" value="11:59pm" />
                    <span class="help-block">All times are shown as Pacific Standard Time (GMT -08:00).</span>
                  </div>
                </div>
              </div>
              <div class="form-actions">
              <button id="info-button" class="btn btn-primary" type="Submit">Next <i class="icon-chevron-right"></i></button>
            </div>
            </form> 
          </div>
          <div class="span3">&nbsp;</div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  <script>
  function success(data, status, xhr) {
          if (data['form_valid'] == true) {
            var iframe = '<iframe src="https://docs.google.com/document/d/'+data['new_doc']+'/edit" width="960" height="3000" scrolling="no">'+
              '<p>Your browser does not support iframes.</p></iframe>';
            $('#info-form').html(iframe);
          } else if (data['form_valid'] == false) {
            $('#info-form').html(data['new_form']);
            console.log('replaced shit');
          } else {
            alert('alex is dumb');
          }
        };
  $('').click(function() {
      $.ajaxSetup({ 
        beforeSend: function(xhr, settings) {
          function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
              var cookies = document.cookie.split(';');
              for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
                }
              }
            }
            return cookieValue;
          }
          if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
            // Only send the token to relative URLs i.e. locally.
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
          }
        } 
      });
      console.log('prepared to send');
      var formData = $('#info-form').serialize();
      $.ajax ({
        url: '.', 
        type: 'POST',
        //timeout: 5000,
        data: formData,
        dataType: 'text',
        /*statusCode: {
          404: function() {
            alert('404');
          },
          200: function(data, status, xhr) {success(data, status, xhr)}
        },*/
         success: function success(data, status, xhr) {
          if (data['form_valid'] == true) {
            var iframe = '<iframe src="https://docs.google.com/document/d/'+data['new_doc']+'/edit" width="960" height="3000" scrolling="no">'+
              '<p>Your browser does not support iframes.</p></iframe>';
            $('#info-form').html(iframe);
          } else if (data['form_valid'] == false) {
            $('#info-form').html(data['new_form']);
            console.log('replaced shit');
          } else {
            alert('alex is dumb');
          }
        },
        error: function(xhr, status, exception) {
          alert('whoops! something went wrong');
          console.log(xhr);
          console.log(status);
          console.log(exception);
        },
       
      });
    });
  </script>
{% endblock content %}

